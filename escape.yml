# This is an Escape Plan for <no value>

# The build name.  Together with the release type makes up the build
# identifier. Format: /[a-zA-Z]+[a-zA-Z0-9-]*/

name: escape-registry

# The version. Either specify the full version or use the '@' symbol to 
# let Escape pick the next version at build time. Format: /[0-9]+(.[0-9]+)*/
# 
# Examples:
#
# Build version 1.5:
#   version: 1.5
#
# Build the next minor release in the 1.* series:
#   version: 1.@
#
# Build the next path release in the 1.1.* series:
#   version: 1.1.@
#
version: '0.10.@'

 
# An (optional) description for this release.

description: "A Go build for the Escape Registry"

logo: logo.png

# Dependencies. Reference dependencies by their full release ID or use
# the '@' symbol to resolve versions at build time.
#
# Examples:
#
# Reference the full release ID to pin to a particular version:
#   depends: [archive-example-v0.1]
#
# To always get the latest version of a particular release:
#   depends: [archive-example-latest]
#
# Or:
#   depends: [archive-example-@]
#
# To resolve the latest minor release:
#   depends: [archive-example-v0.@]
#
# To resolve the latest path release:
#   depends: [archive-example-v0.1.@]

depends:
- escape-core-latest as core

# The files to includes in this release. The files don't have to exist at 
# build time. Globbing patterns are supported.

includes: 
- escape-registry
- LICENSE
- Makefile
- README.md
- "*.go"
- config/
- dao/
- handlers/
- model/
- shared/
- storage/
- vendor/
- docs/

post_build: scripts/build.sh
test: scripts/test.sh

errands:
  upload_to_gcs:
    description: "Upload the produced linux/amd64 binary to a GCS bucket"
    script: scripts/upload_to_gcs.sh
    inputs:
    - id: bucket
      description: "The target bucket"
    - id: credentials
      description: "Service account credentials"
    - id: registry_version
      default: $this.version
  publish_binaries:
    description: Create binaries for all platforms and upload to a GCS bucket
    inputs:
    - id: bucket
      description: "The target bucket"
    - id: credentials
      description: "Service account credentials"
    - id: registry_version
      default: $this.version
    script: scripts/publish-binaries.sh

templates:
- cmd/metadata.go.tpl
